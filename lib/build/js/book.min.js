/*! dlts-aco 2014-07-27 */
YUI().use("node","anim","crossframe","router","json-stringify",function(a){"use strict";var b,c,d=a.one("body"),e=a.one(".home-menu").get("offsetHeight"),f=a.one("iframe"),g=location.pathname.match(/\/book\/(.*)\/(.*)/),h=location.pathname.match(/\/book\/(.*)\/(.*)\/(.*)/),i=a.DOM.viewportRegion(),j=new a.Router({root:"/aco",routes:[{path:"book/1",callbacks:function(){}}]});f.setStyles({top:e,height:i.height-e}),h&&h[3]?(c=h,b=d.getAttribute("data-sourceUrl")+"/books/"+h[2]+"/"+h[3]):g&&g[2]&&(c=g,b=d.getAttribute("data-sourceUrl")+"/books/"+g[2]+"/1"),a.log(b),f.set("src",b),a.on("button:button-fullscreen:on",function(){a.one(".header").setStyles({display:"none",visibility:"hidden"}),a.one("#book").setStyles({top:0,height:i.height})}),a.on("openlayers:change",function(a){j.save("/book/"+c[1]+"/"+c[2]+"/"+a.sequence)}),a.on("button:button-fullscreen:off",function(){a.one(".header").setStyles({display:"initial",visibility:"visible"}),a.one("#book").setStyles({top:e,height:i.height-e})}),f.on("load",function(){var b='frames["book"]',c=d.getAttribute("data-app")+"/css/book.css",e={eventType:"crossframe:css",callback:function(){f.setStyles({visibility:"visible"});var b=new a.Anim({node:"#book",to:{opacity:1},duration:.2});b.run(),a.one(".loading").removeClass("active")}};a.CrossFrame.postMessage(b,c,e),a.Global.on("crossframe:message",function(b,c){var d=JSON.parse(c.message);a.fire(d.fire,d.data)})})});