/*! dlts-aco 2014-07-27 */
YUI().use("node","event","io","node-scroll-info","handlebars","json-parse","jsonp","jsonp-url","gallery-idletimer",function(a){"use strict";function b(){a.log("onFailure")}function c(b){var c=[];return a.Object.each(b,function(a,b){b.match(/discovery-/)&&c.push(a)}),c}function d(){b()}function e(){var c,e=0,l=0,m=0,n=0,o=0,p=1;g.hasClass("io-done")||(o=parseInt(h.getAttribute("data-sourceIndex"),10),p=parseInt(h.getAttribute("data-sourceLength"),10),e=parseInt(h.getAttribute("data-numfound"),10),l=parseInt(h.getAttribute("data-start"),10),m=parseInt(h.getAttribute("data-docslength"),10),n=l+m,e>=n&&(c=i[o]+"&start="+n,a.Array.indexOf(j,c)<0&&!g.hasClass("io-loading")&&(g.scrollInfo.getScrollInfo().atBottom||a.IdleTimer.isIdle()&&pager.get("region").top-k<g.get("winHeight"))&&(g.addClass("io-loading"),a.jsonp(c,{on:{success:f,failure:b,timeout:d},args:[o,p],timeout:3e3}))))}function f(b,c,d){try{var e=parseInt(b.response.numFound,10),f=parseInt(b.response.start,10),i=parseInt(b.response.docs.length,10);b.response.docs.forEach(function(a){a.en={},a.ar={},a.identifier=a.ss_identifer,a.app=a.ss_collection_identifier,a.thumbHref=a.ss_representative_image,a.en.title=a.sm_field_title,a.en.author=a.sm_field_author,a.en.publisher=a.sm_field_publisher,a.en.publication_location=a.sm_field_publication_location,a.en.publication_date=a.sm_field_publication_date_text,a.en.subjects=a.sm_vid_Terms,a.ar.title=a.sm_ar_title,a.ar.author=a.sm_ar_author,a.ar.publisher=a.sm_ar_publisher,a.ar.publication_location=a.sm_ar_publication_location,a.ar.publication_date=a.sm_ar_publication_date,a.ar.subjects=a.sm_ar_subjects}),j.push(this.url),h.setAttribute("data-numFound",e),h.setAttribute("data-start",f),h.setAttribute("data-docsLength",i),h.append(m({items:b.response.docs})),f+i===e&&c+1===d?g.addClass("io-done"):f+i===e&&d>c+1&&(h.setAttribute("data-sourceIndex",c+1),h.setAttribute("data-numFound",0),h.setAttribute("data-start",0),h.setAttribute("data-docsLength",0)),g.removeClass("io-loading")}catch(k){a.log("error")}}var g=a.one("body"),h=a.one(".library-items"),i=c(g.getData()),j=[],k=200,l=a.one("#list-template").getHTML(),m=a.Handlebars.compile(l);a.IdleTimer.subscribe("idle",e),a.IdleTimer.start(5e3),g.plug(a.Plugin.ScrollInfo,{scrollMargin:k}),g.scrollInfo.on({scroll:e}),i[0]&&(h.setAttribute("data-sourceLength",i.length),h.setAttribute("data-sourceIndex",0),a.jsonp(i[0],{on:{success:f,failure:b,timeout:d},args:[0,i.length],timeout:3e3}))});